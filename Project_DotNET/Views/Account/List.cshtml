@model Project_DotNET.Models.ListUsersViewModel

<h2>@Model.title.</h2>

@Html.ValidationSummary("", new { @class = "text-danger" })

@if (@Model.messagesInfo != null)
{
    @Html.LabelFor(m => m.messagesInfo, new { @class = "col-md-4 text-info" })
    <div class="row">
        @foreach (var msg in Model.messagesInfo)
        {
            @msg
            <br />
        }
    </div>
}

@if (@Model.messagesErrors != null)
{
    @Html.LabelFor(m => m.messagesErrors, new { @class = "col-md-4 text-danger" })
    <div class="row">
        @foreach (var msg in Model.messagesErrors)
        {
            @msg
        }
    </div>
}

<br />



<div style="margin:auto">
    <table id="list" class="table table-striped table-hover dt-responsive">
        <thead>
            <tr>
                <td>Matricule</td>
                <td>Prénom</td>
                <td>Nom</td>
                <td>Métier actuel (dernier)</td>
                <td>Entreprise</td>
                <td>Date d'entrée dans l'entreprise</td>
                <td>Actions</td>
            </tr>
        </thead>
        <tbody>
            @foreach (var user in Model.Users)
            {
                <tr id="@user.Id">
                    <td>@user.Pseudo</td>
                    <td>@user.firstName</td>
                    <td>@user.lastName</td>
                    <td>@user.Job.JobName</td>
                    <td>@user.Company.CompanyName</td>
                    <td>@user.firstDay.ToString("dd MMM yyyy")</td>
                    <td><a class="act_see" href="#" name="@user.Id">Plus de détails...</a> | <a class="act_del" href="#" name="@user.Id">Supprimer</a></td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section css{
    <link href="//cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css" rel="stylesheet" />
}

@section scripts{
    <script src="//cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
    <script>
        $(document).ready(function () {
            var table = $("#list").DataTable();

            $("#list tbody a").click(function () {
                var a = $(this)[0];
                if ($(this).hasClass("act_see")) {
                    window.location.href = '/Account/Details/' + a.name;
                }
                else if ($(this).hasClass("act_del")) {
                    if (confirm("Voulez-vous vraiment supprimer cet utilisateur? (Ok pour oui, Annuler pour non)")) {
                        var jqxhr = $.ajax("/Account/Delete/" + a.name)
                              .done(function () {
                                  console.log("Success!");
                              })
                              .fail(function () {
                                  console.log("Error: Request has failed!");
                              });
                        table.row("#" + a.name).remove().draw(false);
                    }
                }

            });
            @* $('#list').DataTable({
                "ajax": {
                    "url": "/Account/JsonList",
                    "type": "GET",
                    "datatype": "json",
                    "deferRender": true,
                },
                "columns": [
                    { "data": "Pseudo", "autowidth": true },
                    { "data": "firstName", "autowidth": true },
                    { "data": "lastName", "autowidth": true },
                    { "data": "JobName", "autowidth": true },
                    { "data": "Roles", "autowidth" : true },
                    { "data": "CompanyName", "autowidth": true },
                    { "data": "firstDay", "autowidth": true },
                ]
            })*@
        })
    </script>
}
