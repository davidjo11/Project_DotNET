@{
    ViewBag.Title = "Curriculum-vitae";
}

<h2>@ViewBag.Title</h2>
<div>
    <h4>Informations générales</h4><br />
    <p>
        @ViewBag.user.firstName<br />
    @ViewBag.user.lastName<br />
    @ViewBag.user.birthday.ToString("dd MMM yyyy")<br />
</p><br />

<h4>Expériences précédentes <button onclick="addJob()">Ajouter une expérience au profil</button></h4> <br />
<table id="list" class="table table-striped table-hover dt-responsive">
    <thead>
        <tr>
            <td>Début de la période</td>
            <td>Fin de la période</td>
            <td>Métier exercé</td>
            <td>Entreprise</td>
            <td>Ville</td>
            <td>Rôle(s) occupé(s)</td>
            <td>Actions</td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>@ViewBag.user.firstDay.ToString("dd MMM yyyy")</td>
            <td>En cours</td>
            <td>@ViewBag.user.Job.JobName</td>
            <td>@ViewBag.user.Company.CompanyName</td>
            <td>@ViewBag.user.Company.city</td>
            <td>En construction</td>
            <td>En construction
                <!--<button class="btn-primary" onclick="location.href='/Manage/EditPeriod?=&userId=@ViewBag.user.Id'">Editer</button>
                    -->
            </td>
        </tr>
        @foreach (var period in ViewBag.user.Periods)
            {
            <tr>
                <td>@period.debut.ToString("dd MMM yyyy")</td>
                <td>@period.fin.ToString("dd MMM yyyy")</td>
                <td>@period.Job.JobName</td>
                <td>@period.Company.CompanyName</td>
                <td>@period.Company.city</td>
                <td>
                    <ul>
                        @foreach (var role in @period.AppRole.AppRoles)
                        {
                            <li>@role.AvailableRoleName</li>
                        }
                    </ul>
                </td>
                <td>
                    <button class="btn-primary" onclick="location.href='/Manage/EditPeriod?periodId=@period.PeriodId&userId=@ViewBag.user.Id'">Editer</button>
                    <button class="btn-primary" onclick="location.href='/Manage/DeletePeriod?periodId=@period.PeriodId&userId=@ViewBag.user.Id'">Supprimer</button>
                </td>
            </tr>
        }
    </tbody>
</table>
</div>

@section css{
    <link href="//cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css" rel="stylesheet" />
}

@section scripts{
    <script src="//cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#list").DataTable();

            $("#list tbody select").click(function () {
                window.location.href = '/Account/AppUser/' + $(this)[0].value;
            });
        })
        function addJob() {
            window.location.href = '/Manage/AddJobToUser';
        }

        function editPeriod(e) {
            window.location.href = '/Manage/EditPeriod/' + e.value;
        }
    </script>
}